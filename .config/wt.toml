# Worktrunk Configuration for Alpacalyzer Algo Trader
#
# This configuration enables seamless worktree management for parallel development,
# critical for the ongoing migration (see migration_plan.md).
#
# Documentation: See AGENTS.md section "Worktree Workflow Management"
#
# ⚠️  AGENT GUARDRAIL: One worktree = One issue = One session
# Each worktree is created for a SINGLE GitHub issue. AI agents must:
# - Complete ONLY the assigned issue in this worktree
# - NEVER start work on a different issue in the same session
# - Report completion and STOP when the issue PR is created/merged
# The human orchestrator will create new worktrees for subsequent issues.

# Post-create hooks run after a new worktree is created (blocking)
# These must succeed before worktree switch completes
[post-create]
# Copy .env file from main worktree (continue if .env doesn't exist)
copy-env = "cp {{ main_worktree_path }}/.env {{ worktree_path }}/.env 2>/dev/null || true"
# Sync dependencies using uv - must succeed for working environment
uv-sync = "uv sync"

# Optional: Install pre-commit hooks in new worktree
# Uncomment if pre-commit is added to the project
# pre-commit-install = "uv run pre-commit install"

# Pre-merge hooks run before merging to target branch (fail-fast)
# All commands must exit 0 for the merge to proceed
[pre-merge]
# Run tests before merging
test = "uv run pytest tests"
# Check linting
lint = "uv run ruff check ."
# Type checking
typecheck = "uv run ty check src"

# Usage Examples
# ----------------
#
# Create worktree for issue #42:
#   wt switch -c feature/issue-42-add-rsi-indicator
#
# List all worktrees:
#   wt list
#
# Switch to worktree:
#   wt switch feature/issue-42-add-rsi-indicator
#
# Remove worktree (after merging):
#   wt remove
#
# For full worktree workflow, see AGENTS.md section:
# "Worktree Workflow Management"
