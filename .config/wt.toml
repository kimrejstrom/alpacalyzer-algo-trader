# Worktrunk Configuration for Alpacalyzer Algo Trader
#
# This configuration enables seamless worktree management for parallel development,
# critical for the ongoing migration (see migration_plan.md).
#
# Documentation: See AGENTS.md section "Worktree Workflow Management"
#
# ⚠️  AGENT GUARDRAIL: One worktree = One issue = One session
# Each worktree is created for a SINGLE GitHub issue. AI agents must:
# - Complete ONLY the assigned issue in this worktree
# - NEVER start work on a different issue in the same session
# - Report completion and STOP when the issue PR is created/merged
# The human orchestrator will create new worktrees for subsequent issues.

# Post-create hooks run after a new worktree is created
[hooks.post_create]

# Copy .env file to new worktree
# This ensures API keys and secrets are available in the new worktree
# without committing them to git.
[[hooks.post_create.commands]]
name = "copy-env"
command = "cp"
args = ["{{main_worktree_dir}}/.env", "{{worktree_dir}}/.env"]
continue_on_error = true  # Don't fail if .env doesn't exist

# Sync dependencies using uv
# Ensures the new worktree has all dependencies installed
[[hooks.post_create.commands]]
name = "uv-sync"
command = "uv"
args = ["sync"]
working_dir = "{{worktree_dir}}"
continue_on_error = false  # Must succeed for working environment

# Optional: Install pre-commit hooks in new worktree
# Uncomment if pre-commit is added to the project
# [[hooks.post_create.commands]]
# name = "pre-commit-install"
# command = "uv"
# args = ["run", "pre-commit", "install"]
# working_dir = "{{worktree_dir}}"
# continue_on_error = true

# Worktree naming convention
# Format: prefix-issue-number-description
# Example: feature-42-add-rsi-indicator
[naming]
default_prefix = "feature"
# Other valid prefixes: bugfix, hotfix, refactor, docs, test

# Worktree root directory
# All worktrees will be created under this directory
[paths]
worktrees_root = ".worktrees"  # Relative to repo root

# Cleanup behavior
[cleanup]
# Auto-remove merged worktrees
auto_remove_merged = true
# Confirm before deleting worktree
confirm_delete = true

# Integration with migration workflow
[metadata]
# Track which migration phase each worktree is for
# This is informational only, no automation attached
migration_phases = [
    "phase-1-strategy-abstraction",
    "phase-2-execution-engine",
    "phase-3-event-logging",
    "phase-4-pipeline",
    "phase-5-backtesting"
]

# Usage Examples
# ----------------
#
# Create worktree for issue #42:
#   wt create feature-42-add-rsi-indicator
#
# Create worktree for migration phase 1:
#   wt create phase-1-strategy-abstraction
#
# List all worktrees:
#   wt list
#
# Switch to worktree:
#   wt switch feature-42-add-rsi-indicator
#
# Remove worktree (after merging):
#   wt remove feature-42-add-rsi-indicator
#
# For full worktree workflow, see AGENTS.md section:
# "Worktree Workflow Management"
